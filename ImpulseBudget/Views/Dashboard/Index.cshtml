@model ImpulseBudget.Models.DashboardViewModel

@{
    ViewData["Title"] = "Dashboard";
}

<div class="container mt-4">
    <h2>Impulse Budget Dashboard</h2>

    <div class="row mt-3">
        <div class="col-md-3 col-6 mb-3">
            <div class="card">
                <div class="card-body">
                    <h6>Income Sources</h6>
                    <h3>@Model.IncomeSourceCount</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-6 mb-3">
            <div class="card">
                <div class="card-body">
                    <h6>Bills</h6>
                    <h3>@Model.BillCount</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-6 mb-3">
            <div class="card">
                <div class="card-body">
                    <h6>Debts</h6>
                    <h3>@Model.DebtCount</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-6 mb-3">
            <div class="card">
                <div class="card-body">
                    <h6>Transactions</h6>
                    <h3>@Model.TransactionCount</h3>
                </div>
            </div>
        </div>
    </div>

    <hr />

    <div class="card mb-3">
        <div class="card-body">
            <h5 class="card-title">Current Balance</h5>
            <p class="card-text display-6">
                @Model.CurrentBalance.ToString("C")
            </p>
            <p class="text-muted">
                Based on starting balance and all transactions since @* starting date, if you want to show it later *@
            </p>
        </div>
    </div>


    <h4>Next 26 Weeks Projection</h4>

    @if (!Model.Projection.Any())
    {
        <p>No projection data. Add some income, bills, and debts, then recalculate.</p>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-sm table-striped">
                <thead>
                    <tr>
                        <th>Week</th>
                        <th>Start Balance</th>
                        <th>Income</th>
                        <th>Bills</th>
                        <th>Debt Payments</th>
                        <th>End Balance</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var p in Model.Projection)
                    {
                        var shortfallClass = p.EndingBalance < 0 ? "table-danger" : "";
                        <tr class="@shortfallClass">
                            <td>@p.WeekStart.ToShortDateString() - @p.WeekEnd.ToShortDateString()</td>
                            <td>@p.StartingBalance.ToString("C")</td>
                            <td>@p.TotalIncome.ToString("C")</td>
                            <td>@p.TotalBills.ToString("C")</td>
                            <td>@p.TotalDebtPayments.ToString("C")</td>
                            <td>@p.EndingBalance.ToString("C")</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>
